<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Projex</title>
    <style>
      body { margin: 0; }
      
      #model-picker {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        font-size: 1.1rem;
        background: rgba(0,0,0,0.5);
        color: white;
        border-radius: 5px;
        padding: 20px;
        max-width: 800px;
        max-height: 80vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .tabs {
        display: flex;
        border-bottom: 2px solid #666;
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.5rem;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .tab:hover {
        background: rgba(255,255,255,0.1);
      }

      .tab.active {
        border-bottom-color: white;
        background: rgba(255,255,255,0.1);
      }

      .tab-content {
        display: none;
        overflow-y: auto;
        max-height: 60vh;
      }

      .tab-content.active {
        display: block;
      }

      .subcategory {
        margin-bottom: 20px;
      }

      .subcategory h3 {
        margin: 0 0 10px 0;
        color: white;
        font-size: 1.5rem;
        border-bottom: 1px solid #666;
        padding-bottom: 5px;
      }

      .model-grid {
        display: flex;
        flex-direction: column;
        gap: 0;
        margin-bottom: 15px;
        align-items: center;
      }

      .model-button {
        padding: 2px 2px;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1.2rem;
        text-align: center;
        margin: 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        width: 100%;
        padding: 8px 2px;
      }

      .model-button:last-child {
        border-bottom: none;
      }

      .model-button:hover {
        background: rgba(255,255,255,0.1);
      }

      a, a:visited, a:active, a:hover {
        color: white;
        text-decoration: underline;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: white;
      }

      .error {
        color: #ff6b6b;
        text-align: center;
        padding: 20px;
      }

      #ai-settings {
        position: absolute;
        bottom: 10px;
        left: 10px;
        padding: 12px 16px;
        background: rgba(0,0,0,0.5);
        color: white;
        border-radius: 5px;
        width: 280px;
        font-size: 0.95rem;
      }

      #ai-settings h3 {
        margin: 0 0 10px 0;
        font-size: 1.1rem;
        border-bottom: 1px solid rgba(255,255,255,0.3);
        padding-bottom: 6px;
      }

      #ai-settings label {
        display: block;
        margin: 8px 0;
        cursor: pointer;
      }

      #ai-settings input[type="checkbox"],
      #ai-settings input[type="radio"] {
        margin-right: 8px;
        cursor: pointer;
      }

      #ai-settings .color-options {
        margin-left: 20px;
        margin-top: 6px;
      }

      #ai-settings .slider-container {
        margin-top: 12px;
      }

      #ai-settings input[type="range"] {
        width: 100%;
        margin-top: 6px;
      }

      #ai-settings .slider-value {
        text-align: center;
        font-size: 0.9rem;
        color: rgba(255,255,255,0.8);
      }

      #ai-settings .disabled {
        opacity: 0.5;
        pointer-events: none;
      }
    </style>
    <script type="module" crossorigin src="./assets/index-DuLHqKrh.js"></script>
  </head>
  <body>
    
    <div id="model-picker">
      <div class="loading">Loading models...</div>
    </div>

    <div id="loading-bar" style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      font-size: 2rem;
      color: white;
      background: rgba(0,0,0,1);
      border-radius: 5px;
      padding: 10px 20px;
      display: none;
      ">
      Loading
    </div>

    <div id="intro" style="
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 8px 12px;
      background: rgba(0,0,0,0.5);
      color: white;
      border-radius: 5px;
      width: 300px;
      ">
      It's projective hex! Invented by Bill Taylor. <br>
      Most models generated by <a href = https://levskaya.github.io/polyhedronisme> polyHÃ©dronisme</a>. <br>
      <br>
  
      Mouse drag or Shift + Arrows : Rotate <br>
      R : Red's turn <br>
      B : Blue's turn <br>
      Shift + Click : Reset tile <br>
      Shift + Z : Undo last move <br>
      Shift + Q : Randomize board <br> 
      Shift + W : Reset board <br>
      <br>
      This polyhedron represents a tiling of RP2;
      opposite faces are identified.
      You win if your color contains a non-contractible loop. 
      <br>
      <br>
      <a href="rules.html"> More Info </a> <br>
    </div>

    <div id="win-popup" style="
      position: fixed;
      top: 50%;
      left: 15%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.85);
      color: white;
      padding: 24px 36px;
      border-radius: 12px;
      font-size: 1.5rem;
      text-align: center;
      display: none;
      z-index: 500;
      ">
    wins! 
    </div>
    
    <div id="error-popup" style="
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.85);
      color: white;
      padding: 24px 36px;
      border-radius: 12px;
      font-size: 1.5rem;
      text-align: center;
      display: none;
      z-index: 500;
      ">
    Invalid model! 
    </div>
    
    <div id="turn-popup" style="
      position: fixed;
      top: 50%;
      left: 85%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.85);
      color: white;
      padding: 24px 36px;
      border-radius: 12px;
      font-size: 1.5rem;
      text-align: center;
      display: none;
      z-index: 999;
      ">
    turn 
    </div>

    <div id="ai-settings">
      <h3>AI Opponent</h3>
      <label>
        <input type="checkbox" id="ai-toggle"> Play vs AI
      </label>
      <div id="ai-options" class="disabled">
        <div class="color-options">
          <label>
            <input type="radio" name="player-color" value="red" checked> Play as Red
          </label>
          <label>
            <input type="radio" name="player-color" value="blue"> Play as Blue
          </label>
        </div>
        <div class="slider-container">
          <label>AI Strength (MCTS iterations):</label>
          <input type="range" id="mcts-slider" min="100" max="10000" value="1000" step="100">
          <div class="slider-value" id="mcts-value">1000 iterations</div>
        </div>
      </div>
    </div>

    <script>
      // Load and display the model picker
      async function loadModelPicker() {
        try {
          const response = await fetch('./models.json');
          const data = await response.json();
          
          const picker = document.getElementById('model-picker');
          picker.innerHTML = '';
          
          // Create tabs
          const tabsContainer = document.createElement('div');
          tabsContainer.className = 'tabs';
          
          const tabContents = document.createElement('div');
          tabContents.className = 'tab-contents';
          
          data.categories.forEach((category, index) => {
            // Create tab button
            const tab = document.createElement('button');
            tab.className = `tab ${index === 0 ? 'active' : ''}`;
            tab.textContent = category.name;
            tab.onclick = () => switchTab(index);
            tabsContainer.appendChild(tab);
            
            // Create tab content
            const content = document.createElement('div');
            content.className = `tab-content ${index === 0 ? 'active' : ''}`;
            
            // Group models by subcategory
            const categoryModels = data.models.filter(model => model.category === category.id);
            const subcategories = {};
            
            categoryModels.forEach(model => {
              if (!subcategories[model.subcategory]) {
                subcategories[model.subcategory] = [];
              }
              subcategories[model.subcategory].push(model);
            });
            
            // Create subcategory sections
            Object.entries(subcategories).forEach(([subcategoryName, models]) => {
              const subcategory = document.createElement('div');
              subcategory.className = 'subcategory';
              
              const subcategoryTitle = document.createElement('h3');
              subcategoryTitle.textContent = subcategoryName;
              subcategory.appendChild(subcategoryTitle);
              
              const modelGrid = document.createElement('div');
              modelGrid.className = 'model-grid';
              
              models.forEach(model => {
                const button = document.createElement('button');
                button.className = 'model-button';
                button.setAttribute('data-model', model.file);
                button.setAttribute('data-gamemode', model.gameMode);
                if (model.atoll) {
                  button.setAttribute('data-atoll', model.atoll);
                }
                
                const buttonText = document.createElement('div');
                buttonText.textContent = model.name;
                button.appendChild(buttonText);
                
                modelGrid.appendChild(button);
              });
              
              subcategory.appendChild(modelGrid);
              content.appendChild(subcategory);
            });
            
            tabContents.appendChild(content);
          });
          
          picker.appendChild(tabsContainer);
          picker.appendChild(tabContents);
          
          
        } catch (error) {
          console.error('Error loading models:', error);
          document.getElementById('model-picker').innerHTML = 
            '<div class="error">Error loading models. Please check the console for details.</div>';
        }
      }
      
      function switchTab(index) {
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Add active class to selected tab and content
        document.querySelectorAll('.tab')[index].classList.add('active');
        document.querySelectorAll('.tab-content')[index].classList.add('active');
      }
      
      // Load the model picker when the page loads
      document.addEventListener('DOMContentLoaded', loadModelPicker);

      // AI Settings wiring
      document.addEventListener('DOMContentLoaded', function() {
        const aiToggle = document.getElementById('ai-toggle');
        const aiOptions = document.getElementById('ai-options');
        const mctsSlider = document.getElementById('mcts-slider');
        const mctsValue = document.getElementById('mcts-value');
        const colorRadios = document.querySelectorAll('input[name="player-color"]');

        aiToggle.addEventListener('change', function() {
          const enabled = this.checked;
          if (enabled) {
            aiOptions.classList.remove('disabled');
          } else {
            aiOptions.classList.add('disabled');
          }
          if (window.setAIEnabled) {
            window.setAIEnabled(enabled);
          }
        });

        colorRadios.forEach(radio => {
          radio.addEventListener('change', function() {
            if (window.setHumanColor) {
              window.setHumanColor(this.value);
            }
          });
        });

        mctsSlider.addEventListener('input', function() {
          mctsValue.textContent = this.value + ' iterations';
          if (window.setMctsIterations) {
            window.setMctsIterations(this.value);
          }
        });
      });
    </script>

</html>